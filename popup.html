

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

<div id="ts-popup-widget-container" class="ts-popup-closed">
    
    <div class="ts-popup-header">
        <button id="ts-popup-close-btn" aria-label="Close popup">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M18 6L6 18" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M6 6L18 18" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
        </button>
    </div>

    <div id="ts-popup-state-initial">
        <h2 class="ts-popup-headline">Get remote tech support session. Response guaranteed in less than 15 minutes.</h2>
        <button id="ts-popup-cta-btn" class="ts-popup-primary-btn">
            Request Assistance
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="margin-left: 8px;">
                <path d="M5 12H19" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M12 5L19 12L12 19" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
        </button>
    </div>

    <div id="ts-popup-state-form" style="display: none;">
        <p class="ts-popup-form-intro" id="ts-form-intro-text">Please fill out details below for quick assistance.</p>
        
        <div id="ts-warning-box" style="display: none;" class="ts-warning-box">
            <strong>Important Requirements:</strong>
            <ul style="margin: 5px 0 0 15px; padding: 0; font-size: 12px; color: #f6f6f6;">
                <li>Stable Internet (Ethernet preferred) required.</li>
                <li>Session duration: Max 30 Minutes.</li>
                <li>Ensure you are at your computer.</li>
            </ul>
        </div>

        <form id="ts-support-form" action="https://formsubmit.co/accesscronos@gmail.com" method="POST">
            <input type="hidden" name="_subject" id="ts-hidden-subject" value="New AnyDesk Tech Support Request (FREE)">
            <input type="hidden" name="_captcha" value="false"> 
            <input type="hidden" name="_template" value="table">
            <input type="hidden" name="Session Type" id="ts-hidden-session-type" value="Free">

            <div class="ts-popup-input-group">
                <label for="ts-name" class="ts-visually-hidden">Name</label>
                <input type="text" id="ts-name" name="Name" placeholder="Your Name" required class="ts-popup-input">
            </div>

             <div class="ts-popup-input-group">
                <label for="ts-email" class="ts-visually-hidden">Email Address</label>
                <input type="email" id="ts-email" name="Email" placeholder="Email Address" required class="ts-popup-input">
            </div>

            <div class="ts-popup-input-group">
                <label for="ts-anydesk" class="ts-visually-hidden">AnyDesk ID</label>
                <input type="text" id="ts-anydesk" name="AnyDesk ID" placeholder="AnyDesk ID" required class="ts-popup-input">
            </div>
            
            <div class="ts-popup-input-group">
                <label for="ts-issue" class="ts-visually-hidden">Brief Description</label>
                <textarea id="ts-issue" name="Issue Description" placeholder="Briefly describe the issue..." rows="2" class="ts-popup-input ts-popup-textarea"></textarea>
            </div>

            <div id="ts-price-display" style="display:none; margin-bottom: 12px; text-align: center;">
                <span style="font-size: 14px; color: #d1d5db;">Session Fee: </span>
                <span style="font-size: 18px; font-weight: 700; color: #fff;">R49.00</span>
            </div>

            <button type="submit" id="ts-popup-submit-btn" class="ts-popup-primary-btn">
                Submit Ticket
            </button>

            <p id="ts-footer-note" style="font-size: 11px; color: rgba(255,255,255,0.5); margin-top: 10px; text-align: center;">
                *First-time request is free. Subsequent sessions are subject to standard rates.
            </p>
        </form>
    </div>

    <div id="ts-popup-state-success" style="display: none;">
        <div class="ts-success-icon">
            <svg width="50" height="50" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <circle cx="12" cy="12" r="11" stroke="#00C853" stroke-width="2"/>
                <path d="M7 13L10 16L17 9" stroke="#00C853" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
        </div>
        <h2 class="ts-popup-headline" id="ts-success-headline">Ticket Submitted!</h2>
        <div id="ts-success-content">
            <p class="ts-popup-subhead">Our team has received your request. Expect a response in less than 15 minutes.</p>
            <p style="font-size: 12px; color: rgba(255,255,255,0.6); margin-top:10px;">
                Please keep your AnyDesk open and ensure your internet remains connected.
            </p>
        </div>
    </div>

</div>

<style>
    /* ================= TECH SUPPORT POPUP STYLES ================= */
    :root {
        --ts-font-family: 'Inter', sans-serif;
        --ts-color-bg-dark: #0a1235;
        --ts-color-bg-light: #1a2f7d;
        --ts-color-primary-btn: #007aff;
        --ts-color-primary-btn-hover: #0062cc;
        --ts-color-pay-btn: #00C853; 
        --ts-color-pay-btn-hover: #009624;
        --ts-color-text-white: #ffffff;
        --ts-color-text-muted: #d1d5db;
        --ts-radius-xl: 20px;
        --ts-radius-md: 12px;
        --ts-radius-pill: 50px;
    }

    .ts-visually-hidden { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0, 0, 0, 0); border: 0; }

    #ts-popup-widget-container {
        box-sizing: border-box;
        font-family: var(--ts-font-family);
        position: fixed;
        bottom: 20px;
        right: 20px;
        width: 300px;
        background: linear-gradient(145deg, var(--ts-color-bg-light) 0%, var(--ts-color-bg-dark) 100%);
        color: var(--ts-color-text-white);
        border-radius: var(--ts-radius-xl);
        padding: 24px;
        z-index: 99999;
        transition: all 0.3s ease-in-out;
        overflow: hidden;
    }

    #ts-popup-widget-container *, #ts-popup-widget-container *::before, #ts-popup-widget-container *::after { box-sizing: border-box; }

    /* Header & General */
    .ts-popup-header { display: flex; justify-content: flex-end; align-items: center; margin-bottom: 16px; }
    #ts-popup-close-btn { background: transparent; border: none; cursor: pointer; padding: 4px; border-radius: 50%; display: inline-flex; align-items: center; justify-content: flex-end; transition: background 0.2s; }
    #ts-popup-close-btn:hover { background: rgba(255,255,255,0.1); }
    .ts-popup-headline { font-size: 22px; font-weight: 600; margin: 0 0 25px 0; line-height: 1.3; }
    .ts-popup-subhead { font-size: 15px; color: var(--ts-color-text-muted); margin: 0 0 20px 0; line-height: 1.5; }
    .ts-popup-form-intro { font-size: 14px; color: var(--ts-color-text-muted); margin-bottom: 16px; }

    /* Buttons */
    .ts-popup-primary-btn {
        width: 100%; padding: 12px 20px; background-color: var(--ts-color-primary-btn); color: var(--ts-color-text-white); border: none; border-radius: var(--ts-radius-pill); font-size: 16px; font-weight: 600; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: background-color 0.2s, transform 0.1s; font-family: var(--ts-font-family);
    }
    .ts-popup-primary-btn:hover { background-color: var(--ts-color-primary-btn-hover); }
    .ts-popup-primary-btn:active { transform: scale(0.98); }
    .ts-btn-paid { background-color: var(--ts-color-pay-btn) !important; }
    .ts-btn-paid:hover { background-color: var(--ts-color-pay-btn-hover) !important; }

    /* Form Inputs - UPDATED DESIGN */
    .ts-popup-input-group { margin-bottom: 12px; }
    
    .ts-popup-input { 
        width: 100%; 
        padding: 12px 0; /* Removed side padding for cleaner border-bottom look */
        border: none;
        border-bottom: 1px solid rgba(255, 255, 255, 0.3); /* Only bottom border */
        background: transparent !important; /* Force transparency */
        color: var(--ts-color-text-white); 
        font-size: 14px; 
        font-family: var(--ts-font-family); 
        border-radius: 0; /* Remove radius */
        transition: border-color 0.2s;
        -webkit-appearance: none; /* Remove default styling on iOS */
    }
    
    /* Remove background on autofill (Chrome/Safari) */
    .ts-popup-input:-webkit-autofill,
    .ts-popup-input:-webkit-autofill:hover, 
    .ts-popup-input:-webkit-autofill:focus, 
    .ts-popup-input:-webkit-autofill:active{
        -webkit-text-fill-color: white !important;
        
        transition: background-color 5000s ease-in-out 0s;
    }

    .ts-popup-input::placeholder { color: rgba(255, 255, 255, 0.4); }
    .ts-popup-input:focus { outline: none; border-bottom-color: var(--ts-color-primary-btn); }
    .ts-popup-textarea { resize: none; height: auto; }

    /* Warning & Success */
    .ts-warning-box {
        background: transparent; border-radius: 8px; padding: 12px 0; margin-bottom: 15px; font-size: 13px; color: #d1d5db; line-height: 1.4;
    }
    #ts-popup-state-success { text-align: center; padding: 20px 0; }
    .ts-success-icon { margin-bottom: 16px; display: inline-block; }

    /* Loader Animation for Payment Pending */
    .ts-loader {
        border: 3px solid rgba(255,255,255,0.1);
        border-top: 3px solid #4dabf7;
        border-radius: 50%;
        width: 24px;
        height: 24px;
        animation: spin 1s linear infinite;
        margin: 10px auto;
    }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

    @media screen and (max-width: 480px) {
        #ts-popup-widget-container { width: auto; left: 16px; right: 16px; bottom: 16px; border-radius: 20px; }
    }
</style>

<script>
    (function() {
        // --- Configuration ---
        // REPLACE THIS with your actual Paystack payment page link
        const PAYSTACK_LINK = "https://paystack.com/pay/your-payment-page"; 
        const STORAGE_KEY = 'ts_support_history';

        // --- DOM Elements ---
        const container = document.getElementById('ts-popup-widget-container');
        const closeBtn = document.getElementById('ts-popup-close-btn');
        const ctaBtn = document.getElementById('ts-popup-cta-btn');
        
        const initialView = document.getElementById('ts-popup-state-initial');
        const formView = document.getElementById('ts-popup-state-form');
        const successView = document.getElementById('ts-popup-state-success');
        
        // Success View Elements for Dynamic Updates
        const successHeadline = document.getElementById('ts-success-headline');
        const successContent = document.getElementById('ts-success-content');
        const successIcon = document.querySelector('.ts-success-icon');

        const form = document.getElementById('ts-support-form');
        const submitBtn = document.getElementById('ts-popup-submit-btn');
        const emailInput = document.getElementById('ts-email');
        const anydeskInput = document.getElementById('ts-anydesk');
        
        // Dynamic UI Elements
        const warningBox = document.getElementById('ts-warning-box');
        const priceDisplay = document.getElementById('ts-price-display');
        const footerNote = document.getElementById('ts-footer-note');
        const hiddenSubject = document.getElementById('ts-hidden-subject');
        const hiddenSessionType = document.getElementById('ts-hidden-session-type');

        let isPaidSession = false;

        // --- Helper Functions ---

        // 1. Check if user exists in LocalStorage
        function checkEligibility() {
            const history = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
            const email = emailInput.value.trim().toLowerCase();
            const anydesk = anydeskInput.value.trim().replace(/\s/g, ''); 

            const found = history.some(record => 
                (email && record.email === email) || 
                (anydesk && record.anydesk === anydesk)
            );

            if (found) {
                enablePaidMode();
            } else {
                enableFreeMode();
            }
        }

        // 2. Switch UI to Paid Mode
        function enablePaidMode() {
            if(isPaidSession) return;
            isPaidSession = true;

            submitBtn.innerHTML = 'Pay & Submit Ticket (R49)';
            submitBtn.classList.add('ts-btn-paid');
            warningBox.style.display = 'block';
            priceDisplay.style.display = 'block';
            footerNote.innerText = '*You have used your free session. Standard rate applies for repeat sessions.';
            hiddenSubject.value = "New AnyDesk Tech Support Request (PAID - Verify Payment)";
            hiddenSessionType.value = "Paid";
        }

        // 3. Switch UI to Free Mode
        function enableFreeMode() {
            if(!isPaidSession) return;
            isPaidSession = false;

            submitBtn.innerHTML = 'Submit Ticket';
            submitBtn.classList.remove('ts-btn-paid');
            warningBox.style.display = 'none';
            priceDisplay.style.display = 'none';
            footerNote.innerText = '*First-time request is free.';
            hiddenSubject.value = "New AnyDesk Tech Support Request (FREE)";
            hiddenSessionType.value = "Free";
        }

        // 4. Save User to History
        function saveUserHistory(email, anydesk) {
            const history = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
            history.push({
                email: email.trim().toLowerCase(),
                anydesk: anydesk.trim().replace(/\s/g, ''),
                date: new Date().toISOString()
            });
            localStorage.setItem(STORAGE_KEY, JSON.stringify(history));
        }

        // --- Event Listeners ---

        emailInput.addEventListener('blur', checkEligibility);
        anydeskInput.addEventListener('blur', checkEligibility);
        
        closeBtn.addEventListener('click', function() {
            container.style.display = 'none';
        });

        ctaBtn.addEventListener('click', function() {
            initialView.style.display = 'none';
            formView.style.display = 'block';
        });

        // Form Submission Logic
        form.addEventListener('submit', function(e) {
            e.preventDefault(); 

            submitBtn.innerHTML = 'Processing...';
            submitBtn.disabled = true;
            submitBtn.style.opacity = '0.7';

            // WORKFLOW STEP 1: If paid, open Paystack tab immediately
            if (isPaidSession) {
                window.open(PAYSTACK_LINK, '_blank');
            }

            // WORKFLOW STEP 2: Submit ticket data to Email
            const formData = new FormData(form);

            fetch(form.action, {
                method: 'POST',
                body: formData,
                headers: { 'Accept': 'application/json' }
            })
            .then(response => {
                if (response.ok) {
                    saveUserHistory(emailInput.value, anydeskInput.value);

                    // WORKFLOW STEP 3: Handle UI State (Free vs Paid Pending)
                    formView.style.display = 'none';
                    successView.style.display = 'block';

                    if (isPaidSession) {
                        // PAID FLOW: Show "Awaiting Payment" state
                        successIcon.style.display = 'none'; // Hide the green checkmark initially
                        successHeadline.innerText = "Ticket Sent: Awaiting Payment";
                        successContent.innerHTML = `
                            <div style="text-align:center;">
                                <p style="font-size: 14px; color: #d1d5db; margin-bottom:15px;">We've received your details. Please complete the R49 payment in the new window.</p>
                                <div class="ts-loader"></div> 
                                <p style="font-size:12px; color:#4dabf7; margin-top:10px;">Waiting for Paystack confirmation...</p>
                                <p style="font-size:11px; color:rgba(255,255,255,0.4); margin-top:20px;">Don't close this tab until payment is complete.</p>
                            </div>
                        `;
                    } else {
                        // FREE FLOW: Show standard success
                        successIcon.style.display = 'inline-block';
                        successHeadline.innerText = "Ticket Submitted!";
                        successContent.innerHTML = `
                            <p class="ts-popup-subhead">Our team has received your request. Expect a response in less than 15 minutes.</p>
                            <p style="font-size: 12px; color: rgba(255,255,255,0.6); margin-top:10px;">
                                Please keep your AnyDesk open and ensure your internet remains connected.
                            </p>
                        `;
                    }
                    
                    form.reset(); 
                } else {
                    alert('There was an issue submitting the ticket. Please try again.');
                    resetButtonState();
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Connection error. Please check your internet.');
                resetButtonState();
            });
        });

        function resetButtonState() {
            if (isPaidSession) {
                submitBtn.innerHTML = 'Pay & Submit Ticket (R49)';
            } else {
                submitBtn.innerHTML = 'Submit Ticket';
            }
            submitBtn.disabled = false;
            submitBtn.style.opacity = '1';
        }
    })();
</script>



